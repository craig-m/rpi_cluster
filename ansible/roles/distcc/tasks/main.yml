---
# DistCC - https://github.com/distcc/distcc
- debug: msg="DistCC Role "
  tags: [distcc]


- name: install distcc
  apt: name={{ item }} state=present
  with_items:
       - distcc
       - distcc-pump
  retries: 1
  become: yes
  tags: [distcc]


- name: distcc config
  template:
    src: distcc_conf.j2
    dest: /etc/default/distcc
    mode: 0644
    owner: root
    group: root
  become: yes
  notify: distcc-restart
  tags: [distcc]


- name: distcc hosts file for compute node
  template:
    src: hostscompute.j2
    dest: /etc/distcc/hosts
    mode: 0644
    owner: root
    group: root
  become: yes
  notify: distcc-restart
  tags: [distcc]


- name: distcc_test test script
  template:
    src: distcc_test.j2
    dest: /opt/cluster/bin/distcc_test.sh
    mode: 0755
  notify: distcc-restart
  tags: [distcc]


- name: distcc enabled on boot
  service: name=distcc enabled=yes
  become: yes
  tags: [distcc]


- name: distcc started
  service: name=distcc state=started
  become: yes
  tags: [distcc]


- name: roles info txt
  lineinfile:
    path: /opt/cluster/data/info_roles.txt
    line: "{{role_path|basename}}"
    owner: root
    group: root
    mode: 0444
  become: yes
  tags: [distcc]
